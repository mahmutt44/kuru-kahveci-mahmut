{% extends 'admin/base.html' %}

{% block title %}Stok Hareketleri - Admin{% endblock %}

{% block content %}
  <div class="d-flex align-items-end justify-content-between mb-3">
    <div>
      <h1 class="h3 mb-1">Stok Hareketleri</h1>
      <div class="text-muted">Son 200 hareket</div>
    </div>
  </div>

  {% if not movements %}
    <div class="alert alert-secondary">Henüz stok hareketi yok.</div>
  {% else %}
    <div class="card shadow-sm">
      <div class="card-body">
        <div class="table-responsive table-wrap">
          <table class="table table-dark table-hover align-middle">
            <thead>
              <tr>
                <th>ID</th>
                <th>Ürün</th>
                <th class="text-end">Değişim (g)</th>
                <th>Kaynak</th>
                <th>Referans</th>
                <th>Not</th>
                <th>Tarih</th>
              </tr>
            </thead>
            <tbody>
              {% for m in movements %}
                <tr>
                  <td class="text-muted">{{ m.id }}</td>
                  <td class="fw-semibold">{{ m.product_name }}</td>
                  <td class="text-end">
                    {% if m.change_gram < 0 %}
                      <span class="text-danger fw-semibold">{{ m.change_gram }}</span>
                    {% else %}
                      <span class="text-success fw-semibold">+{{ m.change_gram }}</span>
                    {% endif %}
                  </td>
                  <td>
                    {% if m.ref_type == 'order' %}
                      <span class="badge text-bg-primary">sipariş</span>
                    {% elif m.ref_type == 'admin' %}
                      <span class="badge text-bg-secondary">admin</span>
                    {% else %}
                      <span class="badge text-bg-info">{{ m.ref_type or '-' }}</span>
                    {% endif %}
                  </td>
                  <td>
                    {% if m.ref_type == 'order' and m.ref_id %}
                      <a class="link-light" href="{{ url_for('admin.orders_detail', order_id=m.ref_id) }}">#{{ m.ref_id }}</a>
                    {% else %}
                      <span class="text-muted">-</span>
                    {% endif %}
                  </td>
                  <td class="text-muted">{{ m.reason }}</td>
                  <td class="text-muted">{{ m.created_at | datetime_tr }}</td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  {% endif %}
{% endblock %}
